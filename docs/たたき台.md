# ticket-tasuki 役割構成

## 経緯

初期設計では7役割（PO/PM/PMO/TL/開発者/QA/リサーチャー）を検討したが、以下の問題が指摘された:

- 管理:実装比率が6:1と過剰な管理オーバーヘッド
- PMOはLLMにとって不要（チケット起票を忘れない）
- リサーチャーとTLの差別化が弱い（知識カットオフ制約）
- 1機能で20ステップ以上のワークフローはレート制限下でボトルネック

ペルソナ（人格設定）についても学術研究の知見から、性格記述は効果がないか負の効果であることが判明し、**具体的なタスク指示と規約**に置き換えた（詳細: アーキテクチャ再検討_20260202.md 5節）。

## 現行の役割構成（方式E: Agent Teams）

### PO（ユーザ/人間）

| 項目 | 内容 |
|------|------|
| 役割 | プロジェクト全体の責任者。要件伝達・方針決定・成果物承認 |
| 実体 | 人間 |
| 備考 | Agent Teams外。leaderに対話形式で指示 |

### Leader（チームリーダー）

| 項目 | 内容 |
|------|------|
| 役割 | 人間のプロキシ。読む・判断する・指示する・レビューする |
| 実体 | Agent Teamsリーダー |
| 制約 | コードを直接編集しない（LeaderConstraintHookで強制） |
| 担当 | USをTask粒度に分解、coder/tester/scribeに委譲、成果物レビュー |
| 旧方式からの統合 | PM + TLの判断機能を統合 |

### Coder（チームメンバー）

| 項目 | 内容 |
|------|------|
| 役割 | コード実装に専念 |
| 実体 | Agent Teamsメンバー |
| 担当 | Edit/Write/Bash。チケットのコメントに成果物を記録 |
| 通信規約 | issue_idでleaderと通信。詳細はRedmineコメント |

### Tester（チームメンバー）

| 項目 | 内容 |
|------|------|
| 役割 | テスト実行・品質検証 |
| 実体 | Agent Teamsメンバー |
| 担当 | テストケース作成・実行。結果をRedmineコメントに記録 |
| 通信規約 | issue_idでleaderと通信。詳細はRedmineコメント |

### Scribe（チームメンバー）

| 項目 | 内容 |
|------|------|
| 役割 | チケット管理（CRUD・階層管理・バージョン管理） |
| 実体 | Agent Teamsメンバー |
| 担当 | Epic/Feature/UserStory/Taskの起票・更新・クローズ |
| 通信規約 | issue_idでleaderと通信。詳細はRedmineコメント |

## 旧7役割との対応

| 旧役割 | 現行の対応 | 変更理由 |
|--------|-----------|----------|
| PO | PO（変更なし） | 人間の役割として維持 |
| PM | **Leaderに統合** | 判断・指示機能をleaderが担当 |
| PMO | **廃止** | LLMはチケット管理を忘れない。Scribeに統合 |
| テクニカルリード | **Leaderに統合** | 技術判断はleaderが担当 |
| 開発者 | **Coder** | 名称変更のみ |
| QAエンジニア | **Tester** | 名称変更のみ |
| リサーチャー | **廃止** | TLとの差別化弱。必要時はleaderがgeneral-purposeで調査 |

## 制御機構

| 機構 | 対象 | 効果 |
|------|------|------|
| sendmessage_guard | 全メンバー間通信 | issue_idパターンを強制。長文メッセージを防止 |
| LeaderConstraintHook | Leader | subagent存在時のEdit/Write等を物理ブロック |
| claude-nagger hook | 全エージェント | ガードレール全般（規約注入・禁止事項強制） |
| チケットコメント規約 | 全エージェント | `[coder]`/`[leader]`等のプレフィックスで実行者明記 |

## 通信規約

```
Agent Teams通信（メールボックス）: チケットIDのみ（例: "issue_124完了"）
詳細情報: 必ずRedmineチケットコメントに記載
他メンバーの作業詳細が必要な場合: Redmineコメントを参照
```

**原則**: Agent間通信はissue_idのみ。詳細は必ずRedmineコメント。これにより:
- InboxPollerのコンテキスト爆発を防止
- セッション死亡時も全履歴がRedmineに残存
- 人間がいつでもチケットで進捗確認可能

## ワークフロー例

### 前提

- TiDDのチケットコメント欄に全報告を記載
- チケットには「決定事項（または事実）」を起票し、「意図・経緯」をコメント欄に記載
- 簡潔かつ端的な記述を心がける

### フロー

```
PO → Leader: 要件伝達（例: SSO連携追加）
Leader → Scribe: チケット起票依頼
Scribe → Redmine: Epic/Feature/UserStory起票
Scribe → Leader: issue_100

Leader: 技術調査（必要に応じてgeneral-purposeで調査）
Leader → PO: pro/con提示
PO → Leader: 方針決定

Leader → Scribe: タスク分解依頼
Scribe → Redmine: 子チケット起票
Scribe → Leader: issue_101, issue_102

Leader → Coder: issue_101（実装指示）
Coder → Redmine: 実装・結果コメント追記
Coder → Leader: issue_101完了

Leader: Redmineコメント参照・レビュー
（問題あれば修正指示を再度coderに委譲）

Leader → Tester: issue_101（テスト依頼）
Tester → Redmine: テスト実行・結果コメント追記
Tester → Leader: issue_101完了

Leader → PO: 完了報告
PO → Leader: 承認
Leader → Scribe: チケットクローズ依頼
```

### 旧ワークフローとの差分

| 旧（7役割） | 現行（方式E） | 改善点 |
|-------------|--------------|--------|
| PM→PMO→PM→TL→PM→DEV→PM→TL→PM→QA→PM→PO | Leader→Coder→Leader→Tester→Leader→PO | ステップ数大幅削減 |
| 全通信がPM経由 | メンバー間直接通信可（IDのみ） | 柔軟な協働 |
| ペルソナベースの役割定義 | タスク指示+規約ベース | 効果的な制御 |
